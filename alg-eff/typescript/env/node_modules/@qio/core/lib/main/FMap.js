"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FMap = exports.NoSuchElement = void 0;
const QIO_1 = require("./QIO");
class NoSuchElement extends Error {
}
exports.NoSuchElement = NoSuchElement;
class FMap {
    constructor() {
        this.cache = new Map();
    }
    static of() {
        return QIO_1.QIO.lift(() => new FMap());
    }
    get(key) {
        return QIO_1.QIO.lift(() => this.cache.get(key)).chain((_) => _ === undefined ? QIO_1.QIO.reject(new NoSuchElement()) : QIO_1.QIO.resolve(_));
    }
    has(key) {
        return QIO_1.QIO.lift(() => this.cache.has(key));
    }
    memoize(fn) {
        return (a) => this.get(a).catch(() => fn(a).chain((r) => this.set(a, r)));
    }
    set(key, value) {
        return QIO_1.QIO.lift(() => void this.cache.set(key, value)).const(value);
    }
}
exports.FMap = FMap;
